# C4-Architekturdiagramme - Anwendungsbeispiele

Dieses Tutorial zeigt dir, wie du das **C4-Modell** mit PlantUML nutzt, um deine Software-Architektur zu dokumentieren.

---

## ğŸ“š Was ist C4?

**C4** steht fÃ¼r **Context, Container, Component, Code** - ein hierarchisches Modell zur Visualisierung von Software-Architekturen.

### Die 4 Abstraktionsebenen

| Level | Name | Frage | Zielgruppe |
|-------|------|-------|------------|
| **1** | System Context | Wie passt das System in die Welt? | Alle Stakeholder |
| **2** | Container | Was sind die Hauptbausteine? | Technisches Team |
| **3** | Component | Wie ist ein Container aufgebaut? | Entwickler, Architekten |
| **4** | Code | Wie ist es implementiert? | Entwickler |

!!! tip "Goldene Regel"
    Verwende **verschiedene Abstraktionsebenen** fÃ¼r **verschiedene Zielgruppen**!
    
    - Executive/Management â†’ Level 1 (Context)
    - Projektleitung â†’ Level 1-2 (Context + Container)
    - Entwickler/Architekten â†’ Level 2-3 (Container + Component)

---

## ğŸ¯ Wann welches Level?

### Level 1: System Context - "Das groÃŸe Bild"

**Verwende wenn:**
- âœ… Neues Projekt vorgestellt wird
- âœ… Externe AbhÃ¤ngigkeiten zeigen
- âœ… Stakeholder-PrÃ¤sentation
- âœ… Systemgrenzen definieren

**Zeigt:**
- ğŸ‘¤ Benutzer und Akteure
- ğŸ“¦ Das System (als Black Box)
- ğŸ”— Externe Systeme
- â¡ï¸ Hauptinteraktionen

**Beispiel:** `c4/beispiel-context.puml` ([siehe unten](#level-1-system-context-beispiel))

---

### Level 2: Container - "Die Bausteine"

**Verwende wenn:**
- âœ… Deployment-Architektur planen
- âœ… Technologie-Entscheidungen dokumentieren
- âœ… Container-/Service-Grenzen definieren
- âœ… Kommunikationswege zeigen

**Zeigt:**
- ğŸ“¦ Container (Services, Datenbanken, Apps)
- ğŸ› ï¸ Technologie-Stack
- ğŸ”— Kommunikation zwischen Containern
- ğŸ’¾ Datenspeicher

!!! info "Container â‰  Docker Container"
    "Container" im C4-Kontext = **Deployable Unit** (kÃ¶nnte ein Docker-Container, eine App, eine DB sein)

**Beispiel:** `c4/beispiel-container.puml` ([siehe unten](#level-2-container-beispiel))

---

### Level 3: Component - "Unter der Haube"

**Verwende wenn:**
- âœ… Interne Struktur eines Containers erklÃ¤ren
- âœ… Verantwortlichkeiten aufteilen
- âœ… Design-Patterns dokumentieren
- âœ… Code-Struktur planen

**Zeigt:**
- ğŸ§© Komponenten innerhalb eines Containers
- ğŸ“‹ Verantwortlichkeiten
- ğŸ”— Interaktionen zwischen Komponenten
- ğŸ› ï¸ Verwendete Patterns/Frameworks

**Beispiel:** `c4/beispiel-component.puml` ([siehe unten](#level-3-component-beispiel))

---

### Level 4: Code - "Die Implementation"

**Verwende wenn:**
- âœ… Klassenstruktur dokumentieren
- âœ… Design-Patterns im Detail zeigen
- âœ… API-Design dokumentieren

**Zeigt:**
- ğŸ“„ Klassen, Interfaces
- ğŸ”— Vererbung, AbhÃ¤ngigkeiten
- ğŸ› ï¸ Methoden, Properties

!!! warning "Achtung"
    Level 4 ist oft **zu detailliert** fÃ¼r Architektur-Dokumentation!  
    Nutze stattdessen IDE-generierte UML-Diagramme oder beschrÃ¤nke dich auf Level 3.

**Status im Projekt:** Nicht enthalten (zu detailliert)

---

## ğŸš€ Praktische Beispiele

### Level 1: System Context - Beispiel

**Szenario:** Dokumentation des EMPC4 VIS Stack fÃ¼r Management-PrÃ¤sentation

**Datei:** `c4/beispiel-context.puml`

??? example "Code anzeigen"
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

    LAYOUT_WITH_LEGEND()

    title System Context Diagram - EMPC4 VIS Stack

    ' Personen
    Person(developer, "Entwickler/Architekt", "Erstellt und pflegt Architektur-Dokumentation")
    Person(stakeholder, "Stakeholder", "Betrachtet und reviewt Architektur-Dokumentation")

    ' Hauptsystem
    System(empc4, "EMPC4 VIS Stack", "Containerisierte Visualisierungsumgebung")

    ' Externe Systeme
    System_Ext(ide, "IDE", "VS Code, IntelliJ mit PlantUML-Plugins")
    System_Ext(git, "Git Repository", "Versionskontrolle fÃ¼r Architektur-Inhalte")

    ' Beziehungen
    Rel(developer, ide, "Erstellt Diagramme in", "PlantUML, Markdown")
    Rel(developer, empc4, "Nutzt fÃ¼r", "Diagramm-Rendering")
    Rel(stakeholder, empc4, "Betrachtet Dokumentation", "HTTPS")

    @enduml
    ```

**So renderst du es:**

=== "Browser (PlantUML Server)"
    1. Ã–ffne [http://arch.local/plantuml](http://arch.local/plantuml)
    2. Kopiere den Code aus `repo/c4/beispiel-context.puml`
    3. Klicke "Submit"
    4. Exportiere als PNG/SVG

=== "VS Code"
    1. Installiere Extension: "PlantUML"
    2. Ã–ffne `beispiel-context.puml`
    3. DrÃ¼cke `Alt+D` fÃ¼r Preview
    4. Rechtsklick â†’ "Export Current Diagram"

=== "CLI (cURL)"
    ```bash
    # PNG generieren
    curl -X POST \
      -H "Content-Type: text/plain" \
      --data-binary @repo/c4/beispiel-context.puml \
      http://arch.local/plantuml/png/ \
      -o context.png
    ```

**Resultat:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          [Person] Entwickler                            â”‚
â”‚                  â†“                                       â”‚
â”‚          [System] EMPC4 VIS Stack                       â”‚
â”‚                  â†“                                       â”‚
â”‚     [External] Git, IDE, Browser                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Anwendungsfall:** Projekt-Kickoff, Stakeholder-PrÃ¤sentation

---

### Level 2: Container - Beispiel

**Szenario:** Deployment-Architektur fÃ¼r DevOps-Team dokumentieren

**Datei:** `c4/beispiel-container.puml`

??? example "Code anzeigen"
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

    LAYOUT_WITH_LEGEND()

    title Container Diagram - EMPC4 VIS Stack

    Person(user, "Benutzer", "Entwickler oder Architekt")

    System_Boundary(empc4, "EMPC4 VIS Stack") {
        Container(reverse_proxy, "Reverse Proxy", "Traefik", "Routing")
        Container(dashboard, "Dashboard", "nginx", "Einstiegsseite")
        Container(plantuml, "PlantUML Server", "Java, Jetty", "Diagramm-Rendering")
        Container(docs, "Dokumentation", "MkDocs Material", "Statische Doku")
    }

    Rel(user, reverse_proxy, "Nutzt", "HTTP")
    Rel(reverse_proxy, dashboard, "Routet zu", "/")
    Rel(reverse_proxy, plantuml, "Routet zu", "/plantuml")
    
    @enduml
    ```

**Was zeigt es:**
- ğŸ“¦ **5 Container** (Traefik, Dashboard, PlantUML, Docs, Excalidraw)
- ğŸ› ï¸ **Technologie-Stack** (Java/Jetty, nginx, MkDocs)
- ğŸ”— **Routing-Logik** (PathPrefix, StripPrefix)
- ğŸ’¾ **Datenspeicher** (Git Repository als Volume)

**Anwendungsfall:** Docker Compose Architektur, Deployment-Planung

---

### Level 3: Component - Beispiel

**Szenario:** Traefik-Konfiguration im Detail erklÃ¤ren

**Datei:** `c4/beispiel-component.puml`

??? example "Code anzeigen"
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

    title Component Diagram - Traefik Reverse Proxy

    Container_Boundary(traefik, "Traefik Reverse Proxy") {
        Component(entrypoints, "Entrypoints", "HTTP", "Port 80/443")
        Component(router, "Router", "HTTP Router", "URL-Routing")
        Component(middleware, "Middlewares", "StripPrefix, Auth", "Request-Verarbeitung")
        Component(loadbalancer, "Load Balancer", "Service LB", "Backend-Verteilung")
    }

    Rel(entrypoints, router, "Leitet weiter")
    Rel(router, middleware, "Wendet an")
    Rel(middleware, loadbalancer, "Forwarded")
    
    @enduml
    ```

**Was zeigt es:**
- ğŸ§© **Interne Komponenten** (Entrypoints, Router, Middlewares)
- ğŸ“‹ **Verantwortlichkeiten** (Routing, Auth, Load Balancing)
- ğŸ”— **Request-Flow** (Entrypoint â†’ Router â†’ Middleware â†’ Backend)

**Anwendungsfall:** Onboarding neuer Entwickler, Troubleshooting

---

## ğŸ“ Schritt-fÃ¼r-Schritt: Dein erstes C4-Diagramm

### Schritt 1: Template wÃ¤hlen

WÃ¤hle die passende Abstraktionsebene:

=== "Level 1 - Context"
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

    title System Context - [DEIN SYSTEM]

    Person(user, "Benutzer", "Beschreibung")
    System(sys, "Mein System", "Was es tut")
    System_Ext(ext, "Externes System", "Integration")

    Rel(user, sys, "Nutzt")
    Rel(sys, ext, "Integriert mit")

    @enduml
    ```

=== "Level 2 - Container"
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

    title Container Diagram - [DEIN SYSTEM]

    Person(user, "Benutzer")

    System_Boundary(sys, "Mein System") {
        Container(webapp, "Web App", "React", "Frontend")
        Container(api, "API", "Node.js", "REST API")
        ContainerDb(db, "Datenbank", "PostgreSQL", "Persistenz")
    }

    Rel(user, webapp, "Nutzt", "HTTPS")
    Rel(webapp, api, "Ruft auf", "REST/JSON")
    Rel(api, db, "Liest/Schreibt", "SQL")

    @enduml
    ```

=== "Level 3 - Component"
    ```plantuml
    @startuml
    !include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

    title Component Diagram - [CONTAINER NAME]

    Container_Boundary(api, "API") {
        Component(auth, "Auth Service", "JWT", "Authentifizierung")
        Component(logic, "Business Logic", "Service Layer", "GeschÃ¤ftslogik")
        Component(repo, "Repository", "Data Layer", "DB-Zugriff")
    }

    Rel(auth, logic, "Authorisiert")
    Rel(logic, repo, "Nutzt")

    @enduml
    ```

---

### Schritt 2: Datei erstellen

```bash
# Erstelle neue Datei im c4-Verzeichnis
cd repo/c4
nano mein-projekt-context.puml
```

---

### Schritt 3: Elemente hinzufÃ¼gen

#### Personen / Akteure

```plantuml
Person(id, "Name", "Beschreibung")
Person_Ext(id, "Externer User", "AuÃŸerhalb der Organisation")
```

#### Systeme

```plantuml
System(id, "System Name", "Was es tut")
System_Ext(id, "Externes System", "Drittanbieter-Service")
```

#### Container

```plantuml
Container(id, "Name", "Technologie", "Verantwortung")
ContainerDb(id, "Datenbank Name", "DB-Type", "Speichert XY")
```

#### Komponenten

```plantuml
Component(id, "Komponente", "Pattern", "Zweck")
```

---

### Schritt 4: Beziehungen definieren

```plantuml
' Einfache Beziehung
Rel(von, zu, "Label")

' Mit Details
Rel(webapp, api, "Ruft auf", "REST/JSON Ã¼ber HTTPS")

' Bidirektional
BiRel(serviceA, serviceB, "Kommuniziert mit", "gRPC")

' Richtungen erzwingen
Rel_D(von, zu, "Nach unten")    ' Down
Rel_U(von, zu, "Nach oben")      ' Up
Rel_L(von, zu, "Nach links")     ' Left
Rel_R(von, zu, "Nach rechts")    ' Right
```

---

### Schritt 5: Layout optimieren

```plantuml
' Layout-Richtung
LAYOUT_TOP_DOWN()           ' Standard
LAYOUT_LEFT_RIGHT()         ' Horizontal

' Legende anzeigen
LAYOUT_WITH_LEGEND()        ' Titel + Legende
SHOW_LEGEND()               ' Nur Legende

' Sketch-Style
LAYOUT_AS_SKETCH()
```

---

### Schritt 6: Notizen hinzufÃ¼gen

```plantuml
note right of element_id
  Wichtige Zusatzinfo:
  - Punkt 1
  - Punkt 2
end note

note left of element_id : Kurze Notiz

note top of element_id
  Performance-Hinweis:
  Caching fÃ¼r 5 Minuten
end note
```

---

### Schritt 7: Rendern & Exportieren

=== "PlantUML Server (empfohlen)"
    ```bash
    # Browser Ã¶ffnen
    open http://arch.local/plantuml
    
    # Datei-Inhalt kopieren und einfÃ¼gen
    cat mein-projekt-context.puml | pbcopy  # macOS
    cat mein-projekt-context.puml | xclip   # Linux
    
    # Im Browser: Paste + Submit
    # Export: PNG/SVG Download
    ```

=== "VS Code Extension"
    ```bash
    # Extension installieren
    code --install-extension jebbs.plantuml
    
    # Settings anpassen (User Settings JSON)
    {
      "plantuml.server": "http://arch.local/plantuml",
      "plantuml.render": "PlantUMLServer"
    }
    
    # Preview: Alt+D
    # Export: Rechtsklick â†’ Export Current Diagram
    ```

=== "Command Line"
    ```bash
    # PNG generieren
    curl -X POST \
      -H "Content-Type: text/plain" \
      --data-binary @mein-projekt-context.puml \
      http://arch.local/plantuml/png/ \
      -o output.png
    
    # SVG generieren (bessere QualitÃ¤t)
    curl -X POST \
      -H "Content-Type: text/plain" \
      --data-binary @mein-projekt-context.puml \
      http://arch.local/plantuml/svg/ \
      -o output.svg
    ```

---

## ğŸ¨ Styling & Best Practices

### Konsistente Farben

```plantuml
!define PRIMARY_COLOR #1168bd
!define SECONDARY_COLOR #438dd5
!define GRAY #999999

' Verwende in Elementen
Container(api, "API", "Node.js", "REST API", $sprite="nodejs", $tags="primary")
```

---

### AussagekrÃ¤ftige Beschreibungen

=== "âŒ Schlecht"
    ```plantuml
    Container(db, "DB", "Postgres", "Datenbank")
    ```

=== "âœ… Gut"
    ```plantuml
    Container(db, "User Database", "PostgreSQL 14", "Speichert Benutzerprofile, Sessions und Audit-Logs")
    ```

---

### Layout-Tipps

```plantuml
' Explizite Richtung fÃ¼r wichtige Beziehungen
Rel_D(frontend, api, "Ruft auf")       ' Nach unten
Rel_R(api, cache, "PrÃ¼ft zuerst")      ' Nach rechts

' Unsichtbare Beziehungen fÃ¼r Layout-Kontrolle
Lay_D(element1, element2)              ' Positioniere element2 unter element1
```

---

### Boundary fÃ¼r Gruppierung

```plantuml
System_Boundary(cloud, "AWS Cloud") {
    Container(lambda, "Functions", "Lambda", "Serverless Logic")
    ContainerDb(dynamo, "Data Store", "DynamoDB", "NoSQL")
}

Enterprise_Boundary(org, "Unsere Organisation") {
    System(erp, "ERP-System")
    System(crm, "CRM-System")
}
```

---

## ğŸ”§ Troubleshooting

### Problem: Diagramm zu groÃŸ / rendert nicht

**LÃ¶sung 1:** ErhÃ¶he `PLANTUML_LIMIT_SIZE` in `.env`

```bash
# .env
PLANTUML_LIMIT_SIZE=16384  # Statt 8192
```

```bash
# Container neu starten
docker compose restart plantuml-backend
```

**LÃ¶sung 2:** Reduziere KomplexitÃ¤t

- Weniger Elemente pro Diagramm
- Teile in mehrere Diagramme auf (z.B. pro Subsystem)
- Verwende hÃ¶here Abstraktionsebene

---

### Problem: Layout ist chaotisch

**LÃ¶sung 1:** Explizite Richtungen

```plantuml
Rel_D(a, b, "...")  ' Down
Rel_R(b, c, "...")  ' Right
Rel_U(c, d, "...")  ' Up
Rel_L(d, a, "...")  ' Left
```

**LÃ¶sung 2:** Unsichtbare Layout-Hilfen

```plantuml
Lay_D(element1, element2)  ' element2 unter element1
Lay_R(element3, element4)  ' element4 rechts von element3
```

**LÃ¶sung 3:** Layout-Modus wechseln

```plantuml
LAYOUT_LEFT_RIGHT()  ' Statt LAYOUT_TOP_DOWN()
```

---

### Problem: Include funktioniert nicht

**HÃ¤ufiger Fehler:**
```plantuml
!include ../includes/styles.puml  ' âŒ Relativer Pfad funktioniert nicht
```

**LÃ¶sung:** Verwende URLs

```plantuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml  ' âœ…
```

---

### Problem: Text zu klein

**LÃ¶sung:**

```plantuml
skinparam DefaultFontSize 14
skinparam DefaultFontName Arial

' Oder fÃ¼r einzelne Elemente
Container(api, "API", "Node.js", "...", $fontsize=16)
```

---

## ğŸ“š Weitere Ressourcen

### Offizielle Dokumentation

- **C4-Model:** [https://c4model.com/](https://c4model.com/)
- **C4-PlantUML:** [https://github.com/plantuml-stdlib/C4-PlantUML](https://github.com/plantuml-stdlib/C4-PlantUML)
- **PlantUML:** [https://plantuml.com/](https://plantuml.com/)

### EMPC4-spezifisch

- **Beispiele:** `repo/c4/` Verzeichnis
- **Architektur-Dokumentation:** [C4-Diagramme](../architecture/c4-diagrams.md)
- **PlantUML Server:** [http://arch.local/plantuml](http://arch.local/plantuml)

### Tutorials & Templates

- **C4-PlantUML Samples:** [GitHub Samples](https://github.com/plantuml-stdlib/C4-PlantUML/tree/master/samples)
- **Real World Examples:** [C4-PlantUML Wiki](https://github.com/plantuml-stdlib/C4-PlantUML/wiki)

---

## ğŸ’¡ NÃ¤chste Schritte

1. **Analysiere die Beispiele:**
   - Ã–ffne `repo/c4/beispiel-context.puml`
   - Rendere es in [PlantUML Server](http://arch.local/plantuml)
   - Verstehe die Struktur

2. **Erstelle dein erstes Diagramm:**
   - WÃ¤hle Level 1 (Context) fÃ¼r den Einstieg
   - Dokumentiere ein einfaches System
   - Experimentiere mit Layout

3. **Integriere in Dokumentation:**
   - Binde Diagramme in MkDocs ein
   - Exportiere als PNG fÃ¼r PrÃ¤sentationen
   - Commite ins Git fÃ¼r Versionierung

4. **Erweitere schrittweise:**
   - Level 2 fÃ¼r Deployment-Details
   - Level 3 fÃ¼r ausgewÃ¤hlte Container
   - Pflege kontinuierlich

---

!!! success "Du bist bereit!"
    Mit C4 und PlantUML hast du jetzt ein mÃ¤chtiges Werkzeug fÃ¼r Architektur-Dokumentation.  
    Start simple, iterate often! ğŸš€
